<p class="text-right text-muted">Printed On {%= frappe.datetime.str_to_user(frappe.datetime.get_datetime_as_string()) %}
</p>

{% var supplierName = []; %}
{% var itemCode = []; %}
{% var total_by_supplier = {}; %}
{% var supplier_payment_terms = {}; %}
{% var fix_supplier_name = ''; %}

{% for (var i = 0, l = data.length; i < l; i++) { %} {% var supplier_name=data[i]['supplier_name']; %} {% var
    item_code=data[i]['item_code']; %} {% if (supplier_name !=="" ) { %} {% fix_supplier_name=supplier_name %} {% } %}
    {% if (data[i]['supplier_name']==="" ) { %} {% data[i]['supplier_name']=fix_supplier_name %} {% } %} {% if
    (!supplierName.includes(supplier_name) && supplier_name !=="" ) { %} {% supplierName.push(supplier_name); %} {% } %}
    {% if (!itemCode.includes(item_code)) { %} {% itemCode.push(item_code); %} {% } %} {% if
    (!supplier_payment_terms.hasOwnProperty(supplier_name)) { %} {%
    supplier_payment_terms[supplier_name]=data[i]['custom_payment_terms']; %} {% } %} {% } %} <h2
    style="text-align: center;">COMPARISON SHEET</h2>
    <table style="border: 1px solid black; width: 100%;">
        <thead>
            <tr>
                <th>Supplier</th>
                {% for (var i = 0, l = supplierName.length; i < l; i++) { %} <th
                    style="border: 1px solid black; text-align:center;" colspan="4">{{ supplierName[i] }}</th>
                    {% } %}
                    <th>REMARKS</th>
            </tr>
            <tr style="border: 1px solid black;">
                <th>Item Code</th>
                {% for (var k = 0, l = supplierName.length; k < l; k++) { %} <th
                    style="border: 1px solid black; text-align:center;">UOM</th>
                    <th style="border: 1px solid black; text-align:center;">Qty</th>
                    <th style="border: 1px solid black; text-align:center;">Rate</th>
                    <th style="border: 1px solid black; text-align:center;">Amount</th>
                    {% } %}
            </tr>
        </thead>
        <tbody>
            {% for (var z = 0, x = data.length; z < x; z++) { %} {% var supplier_name=data[z]['supplier_name']; %} {% if
                (total_by_supplier.hasOwnProperty(supplier_name)) { %} {% total_by_supplier[supplier_name]
                +=data[z]['price']; %} {% } else { %} {% total_by_supplier[supplier_name]=data[z]['price']; %} {% } %}
                {% } %} {% for (var k=0, n=itemCode.length; k < n; k++) { %} <tr>
                <td style="border: 1px solid black;">{{ itemCode[k] }}</td>
                {% for (var x = 0, p = supplierName.length; x < p; x++) { %} {% var soltedData=data.filter(f=>
                    f.supplier_name == supplierName[x] && f.item_code == itemCode[k]); %}
                    {% if (soltedData.length > 0) { %}
                    {% if (soltedData.length > 1) { %}
                    <td style="border: 1px solid black;">
                        {% for (var i = 0, l = soltedData.length; i < l; i++) { %} <div>{{ soltedData[i]['uom'] }}</div>
                            <br>
                            {% } %}
                    </td>
                    <td style="border: 1px solid black;">
                        {% for (var i = 0, l = soltedData.length; i < l; i++) { %} <div>{{ soltedData[i]['qty'] }}</div>
                            <br>
                            {% } %}
                    </td>
                    <td style="border: 1px solid black;">
                        {% for (var i = 0, l = soltedData.length; i < l; i++) { %} <div>{{
                            soltedData[i]['price_per_unit'] }}</div>
                            <br>
                            {% } %}
                    </td>
                    <td style="border: 1px solid black;">
                        {% for (var i = 0, l = soltedData.length; i < l; i++) { %} <div>{{ soltedData[i]['price'] }}
                            </div>
                            <br>
                            {% } %}
                    </td>
                    {% } else { %}
                    <td style="border: 1px solid black;">{{ soltedData[0]['uom'] }}</td>
                    <td style="border: 1px solid black;">{{ soltedData[0]['qty'] }}</td>
                    <td style="border: 1px solid black;">{{ soltedData[0]['price_per_unit'] }}</td>
                    <td style="border: 1px solid black;">{{ soltedData[0]['price'] }}</td>
                    {% } %}
                    {% } else { %}
                    <td style="border: 1px solid black;"></td>
                    <td style="border: 1px solid black;"></td>
                    <td style="border: 1px solid black;"></td>
                    <td style="border: 1px solid black;"></td>
                    {% } %}
                    {% } %}
                    <td style="border: 1px solid black;"></td>
                    </tr>
                    {% } %}
                    <tr>
                        <th style="border: 1px solid black;">PAYMENT TERMS</th>
                        {% for (var m = 0; m < supplierName.length; m++) { %} <td colspan="4"
                            style="border: 1px solid black; text-align: right;">
                            {{ supplier_payment_terms[supplierName[m]] }}
                            </td>
                            {% } %}
                    </tr>
                    <tr>
                        <th style="border: 1px solid black;">TOTAL</th>
                        {% for (var m = 0; m < supplierName.length; m++) { %} <td colspan="4"
                            style="border: 1px solid black; text-align: right;">
                            {% const formattedMoney = ((total_by_supplier[supplierName[m]])).toLocaleString('en-TZ',
                            {style: 'currency', currency: 'TZS'}); %}
                            {{ formattedMoney }}

                            </td>
                            {% } %}
                    </tr>
                    <tr>
                        <th style="border: 1px solid black;">VAT 18%</th>
                        {% for (var m = 0; m < supplierName.length; m++) { %} <td colspan="4"
                            style="border: 1px solid black; text-align: right;">
                            {% const formattedMoney = ((total_by_supplier[supplierName[m]] *
                            0.18)).toLocaleString('en-TZ', {style: 'currency', currency: 'TZS'}); %}
                            {{ formattedMoney }}
                            </td>
                            {% } %}
                    </tr>
                    <tr>
                        <th style="border: 1px solid black;">GRAND TOTAL</th>
                        {% for (var m = 0; m < supplierName.length; m++) { %} <td colspan="4"
                            style="border: 1px solid black; text-align: right;">
                            {% const formattedMoney = ((total_by_supplier[supplierName[m]] +
                            (total_by_supplier[supplierName[m]] * 0.18))).toLocaleString('en-TZ', {style: 'currency',
                            currency: 'TZS'}); %}
                            {{ formattedMoney }}
                            </td>
                            {% } %}
                    </tr>
                    <tr>
                        <th style="border: 1px solid black;">REMARKS</th>
                        <td colspan="{{ supplierName.length * 4 }}" style="border: 1px solid black; text-align: right;">
                        </td>
                    </tr>
        </tbody>
    </table>